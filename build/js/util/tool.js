define("util/tool",["jquery","util/adaptor","util/hash","api","util/ajax","util/user","util/cookie","util/file","underscore"],function(a){var b=a("jquery"),c=a("util/adaptor"),d=a("util/hash"),e=a("api"),f=a("util/ajax"),g=a("util/user"),h=a("util/file"),i=a("underscore"),j='<div class="popup"><div class="pop-input"><input type="text" placeholder="请输入名称" /><div><a href="javascript:;" class="btnType1 jsSubmit load-hidden">确定</a><img class="loading-img" src="images/loading.gif" /></div><a href="javascript:;" class="close">x</a></div></div>',k='<div class="popup"><div class="popwrap"><p>复制到：</p><div class="move-wrap"><%= listdata %></div><a href="javascript:;" class="close">x</a><div><a href="javascript:;" class="btnType1 jsSubmit load-hidden">确定</a><img class="loading-img" src="images/loading.gif" /></div></div></div>',l="<ul><% _.each(data, function(item){ if(item.type=='dir'){ while(item.path.substr(0,1)=='/' && item.path.substr(1,1)=='/'){item.path.substr(1)} %>"+'<li><div class="filelist" data-path="<%= item.path %>"><i class="icon-arrow"></i><span><%= item.name %></span></div></li><% }}) %></ul>',m=b(".jsCopy"),n=(b(".jsMove"),b(".jsDelete")),o=b(".jsRename"),p=b(".jsDownload"),q=b(".jsNew"),r=b(".file-con");m.on("click",function(){if(!b(this).hasClass("disable")){var a=i.template(l,{variable:"data"})([{name:"我的私有云",path:"/",type:"dir"}]),d=b(i.template(k)({listdata:a})),h=null,j=!1;b("body").append(d),d.on("click",".jsSubmit",function(){if(h){b(this).parent().addClass("loading");var a=c.get().obj,i="/"==h.attr("data-path")?h.attr("data-path")+a.name:h.attr("data-path")+"/"+a.name;f({url:e.moveFile,data:{token:g.token,from_path:a.path,to_path:i},success:function(a){d.remove(),0==a.status||alert("接口出错，请稍后再试")},error:function(){d.remove()}})}}),d.on("click",".filelist",function(){j||(h&&h.removeClass("select"),h=b(this),h.addClass("select"),h.parent().hasClass("empty")||(h.parent().hasClass("open")?h.parent().removeClass("open"):h.parent().hasClass("loaded")?h.parent().addClass("open"):(h.parent().addClass("loading"),j=!0,f({url:e.getFileList,data:{path:h.attr("data-path"),token:g.token},success:function(a){if(j=!1,h.parent().removeClass("loading"),a&&0!=a.length){for(var b=0,c=0;c<a.length;c++)"dir"==a[c].type&&b++;b?h.parent().addClass("loaded").addClass("open").append(i.template(l,{variable:"data"})(a)):h.parent().addClass("empty").addClass("loaded")}else h.parent().addClass("empty").addClass("loaded")},error:function(){j=!1,h.parent().removeClass("loading").addClass("empty"),alert("接口出错，请稍后再试")}}))))})}}),o.on("click",function(){if(!b(this).hasClass("disable")){var a=c.get(),h=b(j);b("body").append(h);var i=h.find("input[type=text]");i.val(a.obj.name),h.find(".jsSubmit").on("click",function(){if(""!=i.val()){b(this).parent().addClass("loading");var c=i.val(),j="/"+d.get().path.join("/")+"/"+c;f({url:e.rename,data:{old_dir:a.obj.path,new_dir:j,token:g.token},success:function(b){h.remove(),0==b.status?a.$el.find(".filename").html(c):alert("接口出错，请稍后再试")},error:function(){h.remove(),alert("接口出错，请稍后再试")}})}})}}),q.on("click",function(){if(!b(this).hasClass("disable")){var a=b(j);b("body").append(a),a.find(".jsSubmit").on("click",function(){var c=a.find("input[type=text]");if(""!=c.val()){b(this).parent().addClass("loading");var i="/"+d.get().path.join("/")+"/"+c.val();f({url:e.mkdir,data:{dir:i,token:g.token},success:function(b){a.remove(),0==b.status?h.add({status:0,name:c.val(),path:i,type:"dir"}):alert("接口出错，请稍后再试")},error:function(){a.remove(),alert("接口出错，请稍后再试")}})}})}}),p.on("click",function(){if(!b(this).hasClass("disable")){var a=c.get().obj;window.open(e.download+a.path)}}),n.on("click",function(){if(!b(this).hasClass("disable")){var a=c.get();r.addClass("loading"),f({url:e.rmfile,data:{dir:a.obj.path,token:g.token},success:function(b){r.removeClass("loading"),0==b.status?a.$el.remove():alert("接口出错，请稍后再试")},error:function(){r.removeClass("loading"),alert("接口出错，请稍后再试")}})}})});